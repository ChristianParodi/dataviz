<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CO2 Emissions</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="./../../libs/d3-sankey.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
      /* Sfondo per la Hero Section */
      .hero-bg {
          background-image: url('./../../factory.jpg'); /* Cambia con la tua immagine */
          background-size: cover;
          background-position: center;
      }
  </style>
</head>

<body class="bg-gray-100 font-sans leading-relaxed tracking-normal">

  <!-- Hero Section -->
  <header class="relative hero-bg h-screen flex items-center justify-center">
      <!-- Overlay con sfumatura verde -->
      <div class="absolute inset-0 bg-gradient-to-r from-green-900 via-green-700 to-green-500 opacity-80"></div>

      <!-- Contenuto della Hero Section -->
      <div class="relative text-center z-10 px-4 sm:px-6 lg:px-8 text-white">
          <h1 class="text-5xl font-bold sm:text-7xl mb-6">CO2 Emissions</h1>
          <p class="text-2xl max-w-xl mx-auto mb-8">Le emissioni sono il male del mondo</p>
          <a href="#main_1">
              <button class="mt-8 px-10 py-4 bg-green-600 text-white font-semibold rounded-full shadow-xl hover:bg-green-500 transition duration-300">
                  Start
              </button>
          </a>            
      </div>
  </header>

  <!-- Main Content -->
  <main id="main_1" class=" bg-white">
      <!-- Sezione 1 -->
      <section id="campana1" class="bg-blue-50 py-16 ">
          <script>
           
            legend = Swatches(colorScale, { columns: "180px" })
              const height = 450;
              const marginTop = 50;
              const marginRight = 20;
              const marginBottom = 80;
              const marginLeft = 100;
            
              const top10 = emissions2022.sort((a, b) => b.CO2 - a.CO2).slice(0, 10);
            
              // Scala verticale per i nomi dei paesi
              const y = d3
                .scaleBand()
                .domain(top10.map((d) => d.Country))
                .range([marginTop, height - marginBottom]) // tutti e 214 i paesi dovranno in qualche modo comparire sull'asse
                .padding(0.1);
            
              const yAxis = d3.axisLeft(y).tickSizeOuter(0);
            
              // Scala orizzontale per i valori di CO2
              const x = d3
                .scaleLinear()
                .domain([0, d3.max(top10, (d) => d.CO2)])
                .nice()
                .range([marginLeft, width - marginRight]);
            
              const xAxis = d3.axisBottom(x).tickFormat((x) => `${x} t`);
            
              // Contenitore SVG
              const svg = d3
                .create("svg")
                .attr("viewBox", [0, 0, width, height])
                .attr(
                  "style",
                  `max-width: ${width}px; height: auto; font: 10px sans-serif; overflow: visible;`
                );
            
              const title = svg
                .append("text")
                .attr("x", width / 2) // Center horizontally
                .attr("y", marginTop - 20) // Position above the chart
                .attr("text-anchor", "middle") // Center the text
                .attr("font-size", "24px") // Set font size
                .attr("font-weight", "bold") // Make it bold
                .attr("font-family", "Roboto Slab")
                .attr("text-wrap", "break-word")
                .attr("margin-top", "10px")
                .text("Top 10 per capita CO₂ emitters (2022)");
            
              // Tooltip for hover effect
              const tooltip = d3
                .select("body")
                .append("div")
                .attr("class", "tooltip")
                .style("position", "absolute")
                .style("visibility", "hidden")
                .style("background-color", "#fff")
                .style("border", "1px solid #ccc")
                .style("padding", "5px")
                .style("border-radius", "3px")
                .style("box-shadow", "2px 2px 5px rgba(0,0,0,0.1)");
            
              const bars = svg
                .append("g")
                .attr("fill", "steelblue")
                .selectAll("rect")
                .data(top10)
                .join("rect")
                .style("mix-blend-mode", "multiply") // Darker color when bars overlap during the transition.
                .attr("y", (d) => y(d.Country))
                .attr("x", marginLeft)
                .attr("height", y.bandwidth())
                .attr("width", (d) => x(d.CO2) - marginLeft)
                .attr("fill", (d) => continentColors[d.Continent] || "#ccc")
                .on("mouseover", function (event, d) {
                  tooltip
                    .style("visibility", "visible")
                    .html(`${d.Country}: ${d.CO2.toFixed(2)} t`);
                })
                .on("mousemove", function (event) {
                  tooltip
                    .style("top", event.pageY + 5 + "px")
                    .style("left", event.pageX + 5 + "px");
                })
                .on("mouseout", function () {
                  tooltip.style("visibility", "hidden");
                })
                .text((d) => d.Country);
            
              const gx = svg
                .append("g")
                .attr("class", "xaxis")
                .attr("transform", `translate(0,${height - marginBottom})`)
                .call(xAxis);
            
              const gy = svg
                .append("g")
                .attr("class", "yaxis")
                .attr("transform", `translate(${marginLeft}, 0)`)
                .call(yAxis)
                .call((g) => g.select(".domain").remove());
            
              svg.node().update = function (checked_filters) {
                const data = emissions2022
                  .filter((d) => checked_filters.includes(d.Continent))
                  .sort((a, b) => b.CO2 - a.CO2)
                  .slice(0, 10);
            
                //change x domain
                // x.domain([0, d3.max(data, (d) => d.CO2)]);
                //change y domain
                y.domain(data.map((d) => d.Country));
            
                //change bars
                const rects = svg.selectAll("rect").data(data);
                rects.join(
                  (enter) =>
                    enter
                      .transition()
                      .duration(750)
                      .delay((d, i) => i * 20)
                      .attr("x", marginLeft)
                      .attr("y", (d) => y(d.Country))
                      .attr("height", y.bandwidth())
                      .attr("width", (d) => x(d.CO2) - marginLeft)
                      .attr("fill", (d) => continentColors[d.Continent] || "#ccc"),
                  (update) =>
                    update
                      .transition()
                      .duration(750)
                      .delay((d, i) => i * 20)
                      .attr("x", marginLeft)
                      .attr("y", (d) => y(d.Country))
                      .attr("height", y.bandwidth())
                      .attr("width", (d) => x(d.CO2) - marginLeft)
                      .attr("fill", (d) => continentColors[d.Continent] || "#ccc"),
                  (exit) => exit
                );
                //change x axis
                gx.transition()
                  .duration(750)
                  .delay((d, i) => i * 20)
                  .call(xAxis);
            
                //change y axis
                gy.transition()
                  .duration(750)
                  .delay((d, i) => i * 20)
                  .call(yAxis);
              };
            
              // Add x-axis label
              svg
                .append("text")
                .attr("x", width / 2)
                .attr("y", height - marginBottom / 3) // Position the label below the x-axis
                .attr("text-anchor", "middle")
                .attr("font-size", "18px")
                .attr("font-family", "Roboto Slab")
                .text("Tonnes of CO₂");
            
              document.body.append(svg.node());
            

          </script>
      </section>

      
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-8">
      <div class="container mx-auto px-6">
          <div class="flex flex-col sm:flex-row justify-between items-center">
              <p class="text-center sm:text-left mb-4 sm:mb-0">© 2024 Data Visualization - Bazzi, Parodi, Valentini</p>
              <div class="flex space-x-6">
                  <a href="#" class="hover:text-gray-400">About Us</a>
                  <a href="#" class="hover:text-gray-400">Contact</a>
                  <a href="#" class="hover:text-gray-400">Privacy Policy</a>
              </div>
          </div>
      </div>
  </footer>
</body>
